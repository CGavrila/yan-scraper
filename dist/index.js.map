{"version":3,"sources":["src/index.js"],"names":[],"mappings":"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","file":"src/index.js","sourcesContent":["'use strict';\n\nimport Deque from 'collections/deque';\nimport * as request from 'request';\nimport * as _ from 'lodash';\nimport * as cheerio from 'cheerio';\nvar debug = require('debug')('Scraper');\nvar EventEmitter = require('events').EventEmitter;\n\nlet _singleton = Symbol();\n\nclass Scraper extends EventEmitter {\n\n    constructor(singletonToken) {\n        super();\n        if (_singleton !== singletonToken)\n            throw new Error('Scraper is a singleton class, cannot instantiate directly.');\n\n        this.templates = {};\n        this.deque = new Deque();\n    }\n\n    static get instance() {\n        if(!this[_singleton])\n            this[_singleton] = new Scraper(_singleton);\n\n        return this[_singleton]\n    }\n\n    static destroyInstance() {\n        this[_singleton] = null;\n    }\n\n    addTemplate(template) {\n        if (!template.name) throw new Error('Template name is missing.');\n        if (!template.callback) throw new Error('Template callback is missing.');\n        if (template.name in this.templates) throw new Error('Template already exists.');\n\n        this.templates[template.name] = template;\n    }\n\n    getTemplates() {\n        return this.templates;\n    }\n\n    getQueue() {\n        return this.deque;\n    }\n\n    queue(urls) {\n        if (_.isArray(urls)) {\n            urls.forEach(url => {\n               this.deque.push(url);\n            });\n        }\n        else {\n            this.deque.push(urls);\n        }\n    }\n\n    start() {\n        setTimeout(this._processNextInQueue.bind(this), 0);\n    }\n\n    _processNextInQueue() {\n        let that = this;\n\n        if (this.deque.length > 0) {\n            let nextURL = this.deque.shift();\n            let result;\n\n            debug('Next URL is - ' + nextURL);\n\n            /* Identify the proper callback to be used once the results come in. */\n            let callback = _.find(this.templates, function(template) {\n                return template.matchesFormat(nextURL);\n            }).callback;\n\n            request.get(nextURL, function (error, response, body) {\n                if (!error && response.statusCode == 200) {\n                    debug('Got results for ' + nextURL);\n                    result = callback(body, cheerio.load(body));\n\n                    that.emit('result', result);\n                }\n            });\n\n        }\n\n        setTimeout(this._processNextInQueue.bind(this), 100);\n    }\n}\n\nexport default Scraper;"]}